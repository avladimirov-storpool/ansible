---
- name: Include distro-specific tasks
  include_tasks: "subtasks/configure_network_{{ ansible_os_family|lower }}.yml"
  tags: ['setup-network']

- name: Generate StorPool net interfaces configuration
  command: "/usr/sbin/iface-genconf -a {{ '-o' if sp_overwrite_iface_conf else '' }}"
  changed_when: false
  tags: ['setup-network']

- name: Init first interface
  shell: >
    set -o pipefail && \
      /usr/sbin/storpool_showconf sp_iface1_cfg | cut -d: -f3 | xargs ifup
  changed_when: false
  ignore_errors: true
  tags: ['setup-network']

- name: Init second interface
  shell: >
    set -o pipefail && \
      /usr/sbin/storpool_showconf sp_iface2_cfg | cut -d: -f3 | xargs ifup
  changed_when: false
  ignore_errors: true
  tags: ['setup-network']

- name: Init bond interfaces (if any)
  shell: >
    set -o pipefail && \
      /usr/sbin/storpool_showconf sp_iface1_cfg | cut -d: -f2 | cut -d. -f1 | xargs ifup
  changed_when: false
  ignore_errors: true
  tags: ['setup-network']

- name: Init iface1 VLANs (if any)
  shell: >
    set -o pipefail && \
      /usr/sbin/storpool_showconf sp_iface1_cfg | cut -d: -f2 | xargs ifup
  changed_when: false
  ignore_errors: true
  tags: ['setup-network']

- name: Init iface2 VLANs (if any)
  shell: >
    set -o pipefail && \
      /usr/sbin/storpool_showconf sp_iface2_cfg | cut -d: -f2 | xargs ifup
  changed_when: false
  ignore_errors: true
  tags: ['setup-network']
