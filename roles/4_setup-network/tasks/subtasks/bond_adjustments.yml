---
- name: Get StorPool interfaces
  shell: |
    set -o pipefail
    /usr/sbin/storpool_showconf -n -e -- SP_IFACE1_CFG SP_IFACE2_CFG \
    | cut -d: -f2 \
    | cut -d. -f1
  changed_when: false
  register: sp_interfaces

- name: Check if StorPool uses bond interfaces
  set_fact:
    sp_bonding: "{{ true if sp_interfaces.stdout_lines | select('match', 'bond') | list | count > 0 else false }}"

- name: Get StorPool bond interface
  shell: |
    set -o pipefail
    /usr/sbin/storpool_showconf -n -e -- SP_IFACE1_CFG \
    | cut -d: -f2 \
    | cut -d. -f1
  changed_when: false
  register: sp_bond
  when: sp_bonding

- name: Include distro-specific tasks
  include_tasks: "subtasks/bond_adjustments_{{ ansible_os_family|lower }}.yml"